---
title: "Freedom"
description: pickle-fr.jpg
tags: ["Dans cet article je vous présente la machine que j'ai créée, une machine consacré au détéction de malware."]
---

# Scan Nmap

    └──╼ [★]$ nmap -p1-65535 192.168.0.22
    Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-08 10:37 CET
    Nmap scan report for 192.168.0.22
    Host is up (0.031s latency).
    Not shown: 65534 closed ports
    PORT   STATE SERVICE
    80/tcp open  http
    MAC Address: 08:00:27:A1:40:3C (Oracle VirtualBox virtual NIC)

    Nmap done: 1 IP address (1 host up) scanned in 5.32 seconds
    ─[10:35:38]─[192.168.0.17]─[root@oldprogrammer]─[~/Documents/wild_code_school/freedom]
    └──╼ [★]$ nmap -p80 -sC -sV 192.168.0.22
    Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-08 10:38 CET
    Nmap scan report for 192.168.0.22
    Host is up (0.00070s latency).

    PORT   STATE SERVICE VERSION
    80/tcp open  http    Apache httpd 2.4.38 ((Debian))
    |_http-server-header: Apache/2.4.38 (Debian)
    |_http-title: Office macro control
    MAC Address: 08:00:27:A1:40:3C (Oracle VirtualBox virtual NIC)

    Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
    Nmap done: 1 IP address (1 host up) scanned in 8.62 seconds
    

Le scan à trouvé uniquement le port `80` qui tourne sur Apache, et il semblerait que la version d'[Apache](https://www.apachelounge.com/Changelog-2.4.html) est plus ou moins récent.

# HTTP

Il s'avère que c'est un site qui `traite` et détecte si les fichiers de type `ODS` ou `ODT` peuvent contenir une `Macro` et essayer de détecté si il y a des choses suspicieux dans le `fichier`.

![picture](https://raw.githubusercontent.com/0xEX75/0xEX75.github.io/master/Screenshot_2021-01-09_11-27-26.png)

Donc, l'application semblerait que il n'accepte pas les autres extensions telles que `jpg`, `png`, `gif` etc.. Donc, j'ai décidé de prendre une `liste` complète des [extensions](https://github.com/dyne/file-extension-list) disponibles sur Linux, et essayer extension par extension avec `BurpSuite` pour trouver celui qui correspond pour l'application, et il s'avère que il a trouvé deux extensions assez intéréssantes, c'est `ODS` et `ODT`.

J'ai essayé de créer un fichier `ODS` avec LibreOffice `New > SpreadSheet` et sauvegarder. Il semblerait que l'application décompresse le fichier `ODS` avec ̀`unzip` et semble le mettre dans le dossier `/office/odt/[numéro_aléatoire]/`.

![picture](https://raw.githubusercontent.com/0xEX75/0xEX75.github.io/master/Screenshot_2021-01-09_11-45-09.png)

# Création Macro

Pour cela, nous allons créer une `macro` avec `LibreOffice` et activer les paramètres nécessaires pour que l'application traite notre fichier, donc allons dans la barre de recherche et lançons `LibreOffice`.

Créeons un nouveau un fichier avec `SpreadSheet` et sauvegarder ce fichier. Allons ensuite dans `Tools` > `Macros` > `Organize macros` et de prendre `Basic`. Choissisez le nom de votre de fichier, ensuite de cliquer sur `Standard` et enfin de créer le `Module` avec l'option `New` à droite, comme dans la capture ci-dessous.

![picture](https://raw.githubusercontent.com/0xEX75/0xEX75.github.io/master/Screenshot_2021-01-09_11-50-51.png)

Une fois le module ajouté, logiquement une page va s'ouvrir automatiquement où nous pouvons écrire dessus, donc utilisons la fonction `Shell` pour créer notre `payload` et sauvegardons cela.

![picture](https://raw.githubusercontent.com/0xEX75/0xEX75.github.io/master/Screenshot_2021-01-09_11-57-16.png)

Maintenant nous devons en sorte que lorsque l'utilisateur ouvrivra notre fichier `ODS`, il faut que la `Macro` soit exécute juste après automatiquement. Allons dans `Tools` > `Customize` > `Events` > cliquer sur `Open Document` et ensuite de cliquer sur `Macro` et de choisir votre macro.

![picture](https://raw.githubusercontent.com/0xEX75/0xEX75.github.io/master/Screenshot_2021-01-09_12-02-22.png)

Créeons un listener sur notre machine avec `nc` sur le port `9001` (dans mon cas), et regardons si la machine cible nous return quelque chose.


