---
title: "Exploitation d'une vulnérabilité de type ROP"
description: test.png
tags: ["Dans cet article je vous présente comment exploiter une vulnérabilité de type ROP (Return-oriented programming) permet de contourner des mécanismes notammement l'ASLR et le système NX."]
---

![forthebadge made-with-python](https://media.giphy.com/media/xT9IgG50Fb7Mi0prBC/giphy.gif)

Comment t'allez-vous ? Après un long moment d'absence je décide de revenir pour vous proposez un article sur le `pwn`, plus précisement sur l'exploitation d'une vulnérabilité de type `ROP` (Return-oriented programming).

Vous êtes intéressé ? Alors LET'S GO !

Prérequis :
- Avoir les bases en `pwn` de comprendre et comment attaquer un buffer overflow basique.
- Et d'un ordinateur, eh eh !

# Explication du système ROP

Avant de commencer l'exploitation, il faut bien comprendre à quoi sert ce système et de comprendre son fonctionnement.

Le `ROP`, return-oriented programming, est une technique d'exploitation avancée de type dépassement de pile (stack overflow) permettant l'exécution de code par un attaquant et ce en s'affranchissant plus ou moins efficacement des mécanismes de protection tels que l'utilisation de zones mémoires non-exécutables (cf. bit NX pour Data Execution Prevention, DEP), l'utilisation d'un espace d'adressage aléatoire (Address Space Layout Randomization, `ASLR`).

Notre but concrètement c'est de récupérer des instructions du binaire pour ensuite faire un rassemblement d'instruction (les bouts d'instruction on appel ça un `gadget` c'est le langage utilisé quand nous exploitons du ROP). Imagions que nous avons des instructions basique. (C'est un exemple bien evidamment)

    push   ebp                # Instruction 1
    mov    ebp,esp            # Instruction 2
    push   ecx                # Instruction 3
    sub    esp,0x4            # Instruction 4
    call   0x804848b <secret> # Instruction 5 
    mov    eax,0x0            # Instruction 6

Imaginons que par la suite, nous décidons de prendre les instructions qui nous intéresse pour ensuite faire un rassemblement d'instruction, par exemple.

    push   ebp                # Instruction 1
    mov    ebp,esp            # Instruction 2
    mov    eax,0x0            # Instruction 6

Justement, notre but c'est de récupérer les instructions du binaire pour ensuite modifier le comportement du programme et d'exécuter quelques choses qui nous intéresse par exemple un `SHELL`, eh oui !

Alors, rassurez-vous je vais vous faire une petite démonstration, donc pas de panique.

# Exploitation du ROP

Donc avant tout ça, nous allons activer l'`ASLR` (pour grosso modo randomisée la pile, le tas et également la libc) à l'aide d'une commande.

    root@0xEX75:~/rop# echo 2 | sudo tee /proc/sys/kernel/randomize_va_space

Et voici le programme en C que nous allons exploiter par la suite.

    #include <stdio.h>
    #include <stdlib.h>

    void function_vulnerability()
    {
            char buffer[8];
            gets(buffer);
            printf("%s\n", buffer);
    }

    int main(int argc, char **argv)
    {
            function_vulnerability();
            return 0;
    }

    
